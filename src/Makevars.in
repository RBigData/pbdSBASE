### PETSc stuff
export PETSC_DIR=/usr/lib/petsc
export PETSC_ARCH=
#export PETSC_DIR=/home/mschmid3/Downloads/petsc-3.4.2/linux
#export PETSC_ARCH=linux
#include ${PETSC_DIR}/conf/variables
#include ${PETSC_DIR}/conf/rules


### Configuration
SEXPTOOLS_LDFLAGS = @SEXPTOOLS_LDFLAGS@

SPMD_CPPFLAGS = @SPMD_CPPFLAGS@
SPMD_LDFLAGS = @SPMD_LDFLAGS@ -lpetsc


### Setup R package flags and substitute by configure for ${MPI_...}.
PKG_CPPFLAGS = $(SPMD_CPPFLAGS) -I${PETSC_DIR}/include \
		-I/${HOME}/R/x86_64-pc-linux-gnu-library/3.0/SEXPtools/include
PKG_CFLAGS = -w
PKG_FFLAGS = $(SAFE_FFLAGS) -w 
PKG_LIBS = $(SEXPTOOLS_LDFLAGS) $(FLIBS) $(SPMD_LDFLAGS)


### Setup R source code and objects.
R_OBJS = \
	petsc_converters.o \
	petsc_init.o \
	petsc_printing.o \
	petsc_test.o


OBJECTS = $(R_OBJS)


### For user configuration.
USER_CONF = Makeconf


### Start making here.
all: $(SHLIB)
	@echo "SLAP_LDFLAGS = $(SLAP_LDFLAGS)" > $(USER_CONF)
	@echo "SPMD_CPPFLAGS = $(SPMD_CPPFLAGS)" >> $(USER_CONF)
	@echo "SPMD_LDFLAGS = $(SPMD_LDFLAGS)" >> $(USER_CONF)
	@echo "PKG_CPPFLAGS = $(PKG_CPPFLAGS)" >> $(USER_CONF)
	@echo "PKG_CFLAGS = $(PKG_CFLAGS)" >> $(USER_CONF)
	@echo "PKG_FFLAGS = $(PKG_FFLAGS)" >> $(USER_CONF)
	@echo "PKG_LIBS = $(PKG_LIBS)" >> $(USER_CONF)

$(SHLIB): $(OBJECTS)

clean:
	@rm -rf *.o *.d *.rc *.so *.dylib *.dll *.a *.lib \
					Makedeps Makevars $(USER_CONF) $(SHLIB) $(OBJECTS) \
